---
- name: Deploy Grafana provisioning configuration
  hosts: all
  become: true
  vars_files:
    - variables.yml

  tasks:
    - name: Create Grafana provisioning directories
      ansible.builtin.file:
        path: "{{ item }}"
        state: directory
        mode: "0755"
        owner: "{{ ansible_user }}"
        group: "{{ ansible_user }}"
      loop:
        - "{{ deploy_dir }}/storage/grafana/provisioning/datasources"
        - "{{ deploy_dir }}/storage/grafana/provisioning/dashboards"
        - "{{ deploy_dir }}/storage/grafana/provisioning/dashboards/torrust"
      when: grafana_enabled | default(false)

    - name: Deploy Grafana provisioning files
      ansible.builtin.copy:
        src: "{{ playbook_dir }}/../grafana/provisioning/"
        dest: "{{ deploy_dir }}/storage/grafana/provisioning/"
        mode: "0644"
        owner: "{{ ansible_user }}"
        group: "{{ ansible_user }}"
      when: grafana_enabled | default(false)

# ============================================================================
# Torrust Tracker Deployer - Generated Configuration
# ============================================================================
#
# This file was generated by the Torrust Tracker Deployer.
#
# DOCUMENTATION:
#   Repository:    https://github.com/torrust/torrust-tracker-deployer
#   Template:      templates/ansible/create-backup-storage.yml
#   API Docs:      https://docs.rs/torrust-tracker-deployer/latest/
#
# DESCRIPTION:
#   Ansible playbook to create backup storage directories on remote host.
#   Creates the directory structure required for backup operations.
#
# For configuration options and valid values, see the API documentation link above.
# ============================================================================

---
# This playbook creates the backup storage directory structure on the remote host.
# The directories are created with appropriate permissions and ownership.
#
# Directory Structure:
# /opt/torrust/storage/backup/
# └── etc/              # Backup configuration files
#
# Variables:
# - ansible_user: The SSH user for the remote host (set automatically)

- name: Create Backup storage directories
  hosts: all
  become: true

  tasks:
    - name: Create backup configuration directory
      ansible.builtin.file:
        path: /opt/torrust/storage/backup/etc
        state: directory
        mode: "0755"
        owner: "{{ ansible_user }}"
        group: "{{ ansible_user }}"

    - name: Verify backup configuration directory exists
      ansible.builtin.stat:
        path: /opt/torrust/storage/backup/etc
      register: backup_etc_dir

    - name: Assert backup directories were created
      ansible.builtin.assert:
        that:
          - backup_etc_dir.stat.exists
          - backup_etc_dir.stat.isdir
          - backup_etc_dir.stat.pw_name == ansible_user
        fail_msg: "Backup storage directories were not created properly"
        success_msg: "Backup storage directories created successfully"
